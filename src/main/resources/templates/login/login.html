<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
  <meta charset="UTF-8">
  <title>Login - Sneaker Shop</title>

  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

  <!-- CSS chung cho tất cả trang auth (background video, overlay, layout) -->
  <link rel="stylesheet" th:href="@{/css/login/auth-layout.css}">
  <!-- CSS riêng cho trang login (card + form) -->
  <link rel="stylesheet" th:href="@{/css/login/login.css}">

  <!-- CSS chatbot -->
  <link rel="stylesheet" th:href="@{/css/chatbot.css}">
</head>
<body>

<!-- ====================== VIDEO BACKGROUND (DÙNG CHUNG) ====================== -->
<div class="auth-bg-video-wrapper">
  <video class="auth-bg-video" id="authBgVideo"
         autoplay muted playsinline
         preload="metadata"
         disablepictureinpicture
         th:poster="@{/images/login-bg-poster.png}">
    Trình duyệt của bạn không hỗ trợ video.
  </video>
</div>

<!-- Lớp phủ mờ để form login nổi hơn trên video -->
<div class="auth-bg-overlay"></div>
<!-- ======================================================================== -->

<div class="auth-page-wrapper">
  <div class="auth-card login-card">

    <!-- Logo giày -->
    <div class="login-logo text-center">
      <img th:src="@{/images/logo-shop/logo-sneaker.png}" alt="5A STORE Logo" class="login-logo-img">
    </div>

    <!-- Tiêu đề -->
    <h1 class="login-title text-center">WELCOME, ATHLETE</h1>

    <!-- Subtitle -->
    <p class="login-subtitle text-center">
      Sign in and step into your best performance
    </p>

    <!-- ALERT THÔNG BÁO LỖI ĐĂNG NHẬP -->
    <div th:if="${param.error}"
         class="alert alert-danger alert-dismissible fade show login-alert"
         role="alert">
      <i class="bi bi-exclamation-triangle-fill me-2"></i>
      Sai tài khoản hoặc mật khẩu, vui lòng thử lại.
    </div>

    <!-- FORM ĐĂNG NHẬP -->
    <form th:action="@{/login}" method="post" class="mt-4">

      <!-- Username -->
      <div class="mb-3">
        <label class="form-label login-label">Username</label>
        <div class="input-group">
            <span class="input-group-text login-input-icon">
              <i class="bi bi-person"></i>
            </span>
          <input type="text"
                 class="form-control login-input"
                 name="username"
                 placeholder="Username">
        </div>
      </div>

      <!-- Password -->
      <div class="mb-3">
        <label class="form-label login-label">Password</label>
        <div class="input-group">
            <span class="input-group-text login-input-icon">
              <i class="bi bi-lock"></i>
            </span>
          <input type="password"
                 class="form-control login-input"
                 name="password"
                 id="passwordInput"
                 placeholder="Password">
          <span class="input-group-text login-input-icon-right"
                id="togglePassword"
                style="cursor: pointer;">
              <i class="bi bi-eye-slash"></i>
            </span>
        </div>
      </div>

      <!-- Nút Login -->
      <div class="d-grid mt-3">
        <button type="submit" class="btn login-btn">
          Login
        </button>
      </div>

      <!-- Remember me + Forgot -->
      <div class="d-flex justify-content-between align-items-center mt-3 login-remember-row">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="rememberMe" name="remember-me">
          <label class="form-check-label" for="rememberMe">
            Remember me
          </label>
        </div>
        <a th:href="@{/forgot-password}" class="login-link-small">Forgot my password ?</a>
      </div>

      <!-- Divider -->
      <div class="login-divider text-center mt-3 mb-2">
        <span>or continue with</span>
      </div>

      <!-- Social buttons -->
      <div class="d-flex justify-content-between gap-2 login-social-row">
          <a th:href="@{/oauth2/authorization/google}" class="btn login-social-btn flex-fill">
            <img th:src="@{/images/icon/google-logo.png}" alt="Google" class="social-logo">
            <span>Google</span>
          </a>

        <button type="button" class="btn login-social-btn flex-fill">
          <img th:src="@{/images/icon/facebook-logo.png}" alt="Facebook" class="social-logo">
          <span>Facebook</span>
        </button>
      </div>

      <!-- Thông báo sau khi logout -->
      <p th:if="${param.logout}" style="color: #4caf50; margin-top: 5px;">
        Bạn đã đăng xuất thành công.
      </p>
    </form>

    <!-- Footer -->
    <div class="login-footer text-center mt-4">
      <span>Don't have account ?</span>
      <a th:href="@{/register}" class="login-link-signup">Signup</a>
    </div>

  </div> <!-- /auth-card login-card -->
</div> <!-- /auth-page-wrapper -->

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<!-- 1) Khai báo danh sách video cho TRANG LOGIN -->
<script th:inline="javascript">
  window.AUTH_VIDEO_SOURCES = [
    /*[[@{/videos/basketball.mp4}]]*/,
    /*[[@{/videos/football.mp4}]]*/,
    /*[[@{/videos/badminton.mp4}]]*/,
    /*[[@{/videos/pingpong.mp4}]]*/
  ];
</script>

<!-- 2) JS dùng chung điều khiển video nền -->
<script th:src="@{/js/login/auth-bg.js}"></script>

<!-- Chatbot Fragment -->
<div th:replace="~{fragments/chatbot :: chatbot}"></div>
<!-- Chatbot JS -->
<script th:src="@{/js/chatbot.js}"></script>

<!-- 3) JS: auto-hide alert + toggle password -->
<script>
  document.addEventListener('DOMContentLoaded', function () {
    // --- Ẩn alert lỗi sau 3 giây ---
    const alertEl = document.querySelector('.login-alert');
    if (alertEl) {
      setTimeout(function () {
        try {
          const bsAlert = bootstrap.Alert.getOrCreateInstance(alertEl);
          bsAlert.close();
        } catch (e) {
          alertEl.style.display = 'none';
        }
      }, 3000);
    }

    // --- Show/hide password ---
    const passwordInput = document.getElementById('passwordInput');
    const togglePassword = document.getElementById('togglePassword');

    if (passwordInput && togglePassword) {
      const icon = togglePassword.querySelector('i');

      togglePassword.addEventListener('click', function () {
        const isHidden = passwordInput.type === 'password';
        passwordInput.type = isHidden ? 'text' : 'password';

        icon.classList.toggle('bi-eye-slash', !isHidden);
        icon.classList.toggle('bi-eye', isHidden);
      });
    }
  });
</script>

</body>
</html>
